<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zabbix: Monitoreo en GNS3</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* 1. CONFIGURACIÓN GENERAL */
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #e2e8f0; /* Un fondo neutro para la página */
            display: grid;
            gap: 20px;
            grid-template-columns: 1fr;
            margin: 0;
            min-height: 100vh;
            padding: 20px 0;
            place-items: center;
        }

        .slide-container {
            align-items: center;
            /* Tema Oscuro: Fondo principal de la diapositiva */
            background-color: #121212;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            height: 720px;
            justify-content: center;
            overflow: hidden;
            padding: 60px;
            position: relative;
            width: 1280px;
        }

        /* 1.1 Estilo de fondo abstracto (opcional, para diapositivas que no son de imagen) */
        .slide-container::before {
            content: '';
            position: absolute;
            top: -150px;
            left: -200px;
            width: 400px;
            height: 400px;
            /* Color de acento 1 */
            background: radial-gradient(circle, rgba(74, 144, 226, 0.15), transparent 70%);
            z-index: 0;
            filter: blur(50px);
        }
        .slide-container::after {
            content: '';
            position: absolute;
            bottom: -150px;
            right: -200px;
            width: 400px;
            height: 400px;
            /* Color de acento 2 */
            background: radial-gradient(circle, rgba(123, 200, 246, 0.1), transparent 70%);
            z-index: 0;
            filter: blur(50px);
        }

        .slide-container > * {
            position: relative;
            z-index: 1; /* Asegura que el contenido esté sobre los fondos */
        }

        /* 2. TIPOGRAFÍA COHERENTE (Poppins y Lato) */

        /* Fuentes de Encabezado */
        .slide-container h1,
        .slide-container h2,
        .slide-container h3,
        .slide-container blockquote {
            /* Color de texto principal */
            color: #FFFFFF;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            margin: 0;
        }

        /* Fuentes de Cuerpo de Texto */
        .slide-container p,
        .slide-container li,
        .slide-container .subtitle,
        .slide-container cite,
        .slide-container .tile p {
            /* Color de texto secundario */
            color: #F0F0F0;
            font-family: 'Lato', sans-serif;
        }

        /* Tamaños de Fuente Coherentes */
        .slide-container h1 {
            font-size: 80px;
        }

        .slide-container .slide-title { /* h2 */
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: left;
            width: 100%;
            /* Color de acento 1 para títulos */
            color: #4A90E2; 
        }

        .slide-container .slide-title { /* h2 */
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: left;
            width: 100%;
            /* Color de acento 1 para títulos - MEJORADO CON GRADIENTE */
            background: linear-gradient(135deg, #5aa0f2, #9ad4f8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #4A90E2; /* Fallback */
        }

        .slide-container h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            /* Color de acento 1 */
            color: #4A90E2;
        }

        /* Tamaño unificado de cuerpo de texto */
        .slide-container p,
        .slide-container li,
        .slide-container .subtitle,
        .slide-container cite,
        .slide-container .tile p {
            font-size: 22px;
            line-height: 1.6;
        }

        .slide-container .subtitle {
            font-size: 28px;
            font-weight: 400;
            margin-top: 20px;
            color: #F0F0F0;
        }

        .slide-container .content-area {
            align-items: center;
            display: flex;
            flex-grow: 1;
            justify-content: center;
            width: 100%;
        }

        /* 3. DEFINICIONES DE DISEÑO */

        /* Layout: Full_Background_Image (Usado para Título y Cierre) */
        .full-bg-image {
            padding: 0;
            background-position: center;
            background-size: cover;
        }
        
        .full-bg-image .content-overlay {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 60px;
            /* Superposición oscura para legibilidad */
            background-color: rgba(18, 18, 18, 0.7);
        }

        .full-bg-image h1,
        .full-bg-image .subtitle {
            color: #FFFFFF;
            /* Nos aseguramos que no tengan gradiente */
            background: none;
            -webkit-text-fill-color: unset;
        }

        /* Layout: Image_Right_Text_Left */
        .two-column {
            align-items: center; /* Centrado vertical */
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            width: 100%;
        }

        .two-column ul {
            list-style: none; /* Quitamos bullets estándar */
            margin: 0;
            padding: 0;
        }

        .two-column li {
            margin-bottom: 20px;
            padding-left: 35px;
            position: relative;
        }
        /* Bullet personalizado con color de acento */
        .two-column li::before {
            content: '✓';
            position: absolute;
            left: 0;
            top: 0;
            font-weight: 700;
            /* Color de acento 2 */
            color: #7BC8F6;
        }

        .image-wrapper {
            border-radius: 12px;
            height: 450px;
            overflow: hidden;
            width: 100%;
            background-color: #2a2a2a; /* Fondo para imágenes */
        }

        .image-wrapper img {
            height: 100%;
            /* 'contain' es mejor para logos y screenshots */
            object-fit: contain; 
            width: 100%;
        }

        /* Layout: Tiled_Text_With_Icons */
        .tiled-content {
            align-items: stretch;
            display: flex;
            gap: 40px;
            justify-content: center;
            width: 100%;
        }

        .tile {
            align-items: center;
            /* Color de fondo de las tarjetas */
            background-color: #1E1E1E; 
            border-radius: 12px;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            flex: 1;
            justify-content: flex-start;
            padding: 40px;
            text-align: center;
            /* Transición añadida para "vida" */
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .tile:hover {
            /* Efecto "hover" añadido */
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(74, 144, 226, 0.2);
            border-color: #4A90E2;
        }

        .tile .icon {
            /* Color de acento 1 */
            color: #4A90E2;
            font-size: 48px;
            margin-bottom: 30px;
        }
        .tile h3 {
            font-size: 24px;
        }
        .tile p {
            font-size: 18px;
        }

        /* Layout: Styled_Bullet_Points */
        .bullet-list {
            max-width: 900px;
            width: 100%;
        }

        .bullet-list ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .bullet-list li {
            align-items: center; /* Alinea ícono y texto */
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            padding-left: 0;
            position: relative;
            /* Transición añadida */
            transition: transform 0.3s ease;
        }

        .bullet-list li:hover {
            /* Efecto "hover" añadido */
            transform: translateX(10px);
        }

        .bullet-list i {
            /* Color de acento 2 */
            color: #7BC8F6;
            font-size: 28px;
            text-align: center;
            width: 35px; /* Ancho fijo para alineación */
        }
        
        .bullet-list li p {
            margin: 0;
            flex: 1;
        }
        .bullet-list li code {
            background-color: #333;
            color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* Layout: Quote */
        .quote-layout {
            text-align: center;
            width: 90%;
        }

        .quote-layout blockquote {
            font-size: 48px;
            font-weight: 700;
            font-family: 'Courier New', Courier, monospace; /* Fuente monoespaciada para código */
            line-height: 1.4;
            margin: 0 0 30px 0;
            padding: 20px;
            position: relative;
            color: #FFFFFF;
            background-color: #1E1E1E;
            border: 1px solid #333;
            border-radius: 8px;
            border-left: 10px solid #4A90E2; /* Acento */
        }

        /* Ocultamos las comillas estándar para el código */
        .quote-layout blockquote::before,
        .quote-layout blockquote::after {
            content: none;
        }

        .quote-layout cite {
            color: #F0F0F0;
            font-size: 22px;
            font-style: normal;
        }
        
        .quote-layout .quote-intro {
            font-size: 22px;
            color: #F0F0F0;
            margin-bottom: 20px;
        }

        /* Layout: Q&A */
        .qa-layout {
            text-align: center;
            width: 100%;
            align-self: center;
        }

        .qa-layout h2 {
            font-size: 80px;
            margin-bottom: 20px;
            /* Color de acento 1 - MEJORADO CON GRADIENTE */
            background: linear-gradient(135deg, #5aa0f2, #9ad4f8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #4A90E2; /* Fallback */
        }

        .qa-layout p {
            font-size: 28px;
            color: #F0F0F0;
        }

        .qa-layout .contact-info {
            color: #7BC8F6;
            font-size: 32px;
            font-weight: 700;
            margin-top: 40px;
        }

        /* --- NUEVAS ANIMACIONES --- */
        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Aplicar animación de entrada */
        .slide-container .slide-title,
        .slide-container h1 {
            animation: fadeInSlide 0.7s ease-out 0.3s both;
        }
        
        .slide-container .subtitle,
        .slide-container .content-area {
            animation: fadeInSlide 0.7s ease-out 0.5s both;
        }

        /* Stagger (escalonado) para listas y tarjetas */
        .bullet-list li,
        .two-column li,
        .tile {
            animation: fadeInSlide 0.6s ease-out both;
            /* Empezamos con opacidad 0 antes de la animación */
            opacity: 0;
        }

        .bullet-list li:nth-child(1) { animation-delay: 0.5s; }
        .bullet-list li:nth-child(2) { animation-delay: 0.6s; }
        .bullet-list li:nth-child(3) { animation-delay: 0.7s; }
        .bullet-list li:nth-child(4) { animation-delay: 0.8s; }
        .bullet-list li:nth-child(5) { animation-delay: 0.9s; }
        .bullet-list li:nth-child(6) { animation-delay: 1.0s; }

        .two-column li:nth-child(1) { animation-delay: 0.5s; }
        .two-column li:nth-child(2) { animation-delay: 0.6s; }
        .two-column li:nth-child(3) { animation-delay: 0.7s; }

        .tile:nth-child(1) { animation-delay: 0.5s; }
        .tile:nth-child(2) { animation-delay: 0.7s; }
        .tile:nth-child(3) { animation-delay: 0.9s; }

        .quote-layout .quote-intro { animation: fadeInSlide 0.7s ease-out 0.5s both; }
        .quote-layout blockquote { animation: fadeInSlide 0.7s ease-out 0.7s both; }
        .quote-layout cite { animation: fadeInSlide 0.7s ease-out 0.9s both; }

        .qa-layout h2 { animation-delay: 0.3s; }
        .qa-layout p:nth-of-type(1) { animation-delay: 0.5s; }
        .qa-layout p:nth-of-type(2) { animation-delay: 0.6s; }
        .qa-layout .contact-info { animation-delay: 0.8s; }
        
        .two-column .image-wrapper {
             animation: fadeInSlide 0.7s ease-out 0.6s both;
        }

        /* --- NUEVO CSS PARA GEMINI --- */

        .gemini-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            width: 100%;
            align-items: flex-start;
        }

        #gemini-prompt-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #gemini-prompt {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border-radius: 8px;
            border: 1px solid #555;
            background-color: #2a2a2a;
            color: #F0F0F0;
            font-family: 'Lato', sans-serif;
            resize: vertical;
        }

        #gemini-ask-btn {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            color: #FFFFFF;
            background: linear-gradient(135deg, #4A90E2, #7BC8F6);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #gemini-ask-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(74, 144, 226, 0.2);
        }

        #gemini-ask-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #gemini-response-container {
            background-color: #1E1E1E;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
            min-height: 300px;
            max-height: 400px;
            color: #F0F0F0;
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            overflow-y: auto;
            font-size: 16px;
        }

        #gemini-response-container p:first-child {
            margin-top: 0;
        }
        #gemini-response-container p:last-child {
            margin-bottom: 0;
        }

        /* Loading Spinner */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #F0F0F0;
            border-bottom-color: #4A90E2;
            border-radius: 50%;
            display: block;
            margin: 20px auto;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

<!-- Slide 1: Full_Background_Image (Title) -->
<div class="slide-container full-bg-image" id="slide1" style="background-image: url('http://googleusercontent.com/image_collection/image_retrieval/14481768430061027841');">
    <div class="content-overlay">
        <h1>Zabbix: Tu Red Bajo Control</h1>
        <p class="subtitle">De la Instalación en Ubuntu al Monitoreo en GNS3</p>
    </div>
</div>

<!-- Slide 2: Image_Right_Text_Left (What is Zabbix?) -->
<div class="slide-container" id="slide2">
    <h2 class="slide-title">¿Qué es Zabbix?</h2>
    <div class="content-area">
        <div class="two-column">
            <div>
                <ul>
                    <li>Solución de monitoreo open-source de nivel empresarial.</li>
                    <li>Recopila métricas de red, servidores, apps y la nube.</li>
                    <li>Visualiza datos, detecta problemas y envía alertas.</li>
                    <li>Perfecto para infraestructuras de cualquier tamaño.</li>
                </ul>
            </div>
            <div>
                <div class="image-wrapper">
                    <img src="http://googleusercontent.com/image_collection/image_retrieval/3697057872845383611" alt="Logo de Zabbix sobre fondo oscuro">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slide 3: Tiled_Text_With_Icons (The Lab) -->
<div class="slide-container" id="slide3">
    <h2 class="slide-title">Nuestro Laboratorio</h2>
    <div class="content-area">
        <div class="tiled-content">
            <div class="tile">
                <div class="icon"><i class="fa-solid fa-server"></i></div>
                <h3>Zabbix Server</h3>
                <p>Una máquina virtual corriendo Ubuntu 22.04 LTS donde instalaremos Zabbix.</p>
            </div>
            <div class="tile">
                <div class="icon"><i class="fa-solid fa-network-wired"></i></div>
                <h3>Router Cisco</h3>
                <p>Un dispositivo virtual (vIOS) dentro de GNS3 que será nuestro objetivo de monitoreo.</p>
            </div>
            <div class="tile">
                <div class="icon"><i class="fa-solid fa-cloud"></i></div>
                <h3>Conexión</h3>
                <p>Un nodo 'Cloud' en GNS3 que une la red virtual con la VM de Zabbix (vía NAT o Bridge).</p>
            </div>
        </div>
    </div>
</div>

<!-- Slide 4: Styled_Bullet_Points (Install) -->
<div class="slide-container" id="slide4">
    <h2 class="slide-title">Paso 1: Instalación en Ubuntu 22.04</h2>
    <div class="content-area">
        <div class="bullet-list">
            <ul>
                <li><i class="fa-solid fa-download"></i><p>Añadir el Repositorio oficial de Zabbix (6.0 LTS).</p></li>
                <li><i class="fa-solid fa-cogs"></i><p>Instalar paquetes: <code>zabbix-server-mysql</code>, <code>zabbix-frontend-php</code>, <code>zabbix-agent</code>.</p></li>
                <li><i class="fa-solid fa-database"></i><p>Crear la base de datos y el usuario para Zabbix en MySQL.</p></li>
                <li><i class="fa-solid fa-file-import"></i><p>Importar el esquema inicial de la base de datos.</p></li>
                <li><i class="fa-solid fa-key"></i><p>Editar <code>/etc/zabbix/zabbix_server.conf</code> con la contraseña de la BD.</p></li>
                <li><i class="fa-solid fa-play-circle"></i><p>Reiniciar servicios y completar la configuración en el frontend web.</p></li>
            </ul>
        </div>
    </div>
</div>

<!-- Slide 5: Image_Right_Text_Left (GNS3 Setup) -->
<div class="slide-container" id="slide5">
    <h2 class="slide-title">Paso 2: Configurando GNS3</h2>
    <div class="content-area">
        <div class="two-column">
            <div>
                <ul>
                    <li>Arrastra un router Cisco (vIOS) a tu topología en GNS3.</li>
                    <li>Añade un nodo 'Cloud' (NAT o Bridge) para conectar tu VM Zabbix.</li>
                    <li>Asegura que haya conectividad IP (¡usa <code>ping</code>!) entre el router y el servidor Zabbix.</li>
                </ul>
            </div>
            <div>
                <div class="image-wrapper">
                    <img src="http://googleusercontent.com/image_collection/image_retrieval/14041612827160683475" alt="Diagrama de topología de red en GNS3 mostrando un router y una nube">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slide 6: Quote (SNMP) -->
<div class="slide-container" id="slide6">
    <h2 class="slide-title">Paso 3: Habilitando SNMP</h2>
    <div class="content-area">
        <div class="quote-layout">
            <p class="quote-intro">SNMP (Protocolo Simple de Administración de Red) permite a Zabbix "preguntar" al router por su estado. Lo activamos en el router Cisco con:</p>
            <blockquote>snmp-server community zabbix-ro RO</blockquote>
            <cite>Esta es la configuración clave en el router para permitir la lectura (Read-Only).</cite>
        </div>
    </div>
</div>

<!-- Slide 7: Image_Right_Text_Left (Zabbix at Work) -->
<div class="slide-container" id="slide7">
    <h2 class="slide-title">Paso 4: ¡Magia! Zabbix en Acción</h2>
    <div class="content-area">
        <div class="two-column">
            <div>
                <ul>
                    <li>Ir a <strong>Configuration &rarr; Hosts &rarr; Create host</strong>.</li>
                    <li>Añadir la IP del router y seleccionar un Grupo.</li>
                    <li>En la pestaña <strong>Interfaces</strong>, añadir una de tipo <code>SNMP</code>.</li>
                    <li>En <strong>Templates</strong>, enlazar la plantilla 'Cisco IOS by SNMP'.</li>
                    <li>En <strong>Macros</strong>, ajustar <code>{$SNMP_COMMUNITY}</code> a 'zabbix-ro'.</li>
                </ul>
            </div>
            <div>
                <div class="image-wrapper">
                    <img src="http://googleusercontent.com/image_collection/image_retrieval/14349374037522455842" alt="Dashboard de Zabbix mostrando métricas de interfaz de red">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slide 8: Full_Background_Image (Result) -->
<div class="slide-container full-bg-image" id="slide8" style="background-image: url('http://googleusercontent.com/image_collection/image_retrieval/16341997362409157595');">
    <div class="content-overlay">
        <h1>El Resultado: Visibilidad Total</h1>
        <p class="subtitle">Datos de CPU, memoria y tráfico de red fluyendo en tiempo real desde GNS3.</p>
    </div>
</div>

<!-- Slide 9: Q&A (Conclusion) -->
<div class="slide-container" id="slide9">
    <div class="qa-layout">
        <h2>¿Próximo Paso?</h2>
        <p>¡No te limites a observar, automatiza! Zabbix es una herramienta increíblemente poderosa.</p>
        <p>¡Explórala y experimenta!</p>
        <div class="contact-info">
            ¡Gracias por tu atención!
        </div>
    </div>
</div>

<!-- Slide 10: Gemini AI Troubleshooter -->
<div class="slide-container" id="slide10">
    <h2 class="slide-title">Solucionador de Problemas ✨</h2>
    <div class="content-area">
        <div class="gemini-layout">
            <div id="gemini-prompt-container">
                <p>¿Atascado? Pregúntale a nuestro asistente experto en Zabbix y GNS3.</p>
                <textarea id="gemini-prompt" rows="4" placeholder="Ej: 'Mi host SNMP no responde en Zabbix, ¿qué reviso?'"></textarea>
                <button id="gemini-ask-btn">
                    <i class="fa-solid fa-magic-sparkles"></i> Preguntar al Experto
                </button>
            </div>
            
            <div id="gemini-response-container">
                <p id="gemini-response-placeholder">Tu respuesta aparecerá aquí...</p>
                <div id="gemini-response" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

</body>

<script>
    const askButton = document.getElementById('gemini-ask-btn');
    const promptInput = document.getElementById('gemini-prompt');
    const responseContainer = document.getElementById('gemini-response');
    const responsePlaceholder = document.getElementById('gemini-response-placeholder');

    if (askButton) {
        askButton.addEventListener('click', handleGeminiQuery);
    }

    async function handleGeminiQuery() {
        const userQuery = promptInput.value;
        if (!userQuery.trim()) {
            responseContainer.innerHTML = '<p style="color: #ff6b6b;">Por favor, escribe una pregunta.</p>';
            responseContainer.style.display = 'block';
            responsePlaceholder.style.display = 'none';
            return;
        }

        setLoading(true);

        const systemPrompt = "Eres un experto de clase mundial en Zabbix, GNS3, redes Cisco y SNMP. Tu objetivo es ayudar a un usuario a solucionar un problema. Proporciona respuestas claras, concisas y en formato markdown (usa '*' para bullets). Ve al grano y ofrece pasos accionables. La pregunta del usuario es:";
        const fullPrompt = ${systemPrompt}\n\n${userQuery};

        try {
            const generatedText = await callGeminiApi(fullPrompt);
            displayResponse(generatedText);
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            displayResponse("Lo siento, ocurrió un error al contactar al asistente. Por favor, revisa la consola para más detalles.", true);
        } finally {
            setLoading(false);
        }
    }

    async function callGeminiApi(prompt, retries = 3, delay = 1000) {
        const apiKey = ""; // API key will be provided by the environment
        const apiUrl = https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey};

        const payload = {
            contents: [{
                parts: [{ text: prompt }]
            }],
            // No system instruction for this model, include it in the main prompt.
        };

        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(HTTP error! status: ${response.status}, body: ${errorBody});
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    console.warn("Unexpected API response structure:", data);
                    throw new Error("Respuesta inesperada de la API de Gemini.");
                }

            } catch (error) {
                console.warn(API call attempt ${i + 1} failed. Retrying in ${delay}ms..., error.message);
                if (i === retries - 1) {
                    throw error; // Throw error after last retry
                }
                await new Promise(resolve => setTimeout(resolve, delay));
                delay *= 2; // Exponential backoff
            }
        }
    }

    function setLoading(isLoading) {
        if(askButton) askButton.disabled = isLoading;
        if (isLoading) {
            responsePlaceholder.style.display = 'none';
            responseContainer.style.display = 'block';
            responseContainer.innerHTML = '<div class="loader"></div>';
        } else {
            // Don't clear loader, displayResponse will do it
        }
    }

    function displayResponse(text, isError = false) {
        responseContainer.innerHTML = ''; // Clear loader
        responseContainer.style.display = 'block';
        responsePlaceholder.style.display = 'none';

        if (isError) {
            responseContainer.innerHTML = <p style="color: #ff6b6b;">${text}</p>;
        } else {
            // Basic markdown-to-HTML
            let formattedText = text
                .replace(/\n\n/g, '</p><p>') // Paragraphs
                .replace(/\n/g, '<br>') // Line breaks
                .replace(/\\(.?)\\*/g, '<strong>$1</strong>') // Bold
                .replace(/\(?!\)(.?)\/g, '<em>$1</em>') // Italic
                .replace(/([^]+)`/g, '<code>$1</code>') // Inline code
                .replace(/^\s*\\s(.?)$/gm, '<ul><li>$1</li></ul>') // Bullets (basic)
                .replace(/<\/ul>\s*<ul>/g, ''); // Merge adjacent lists

            responseContainer.innerHTML = formattedText;
        }
    }
</script>

</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zabbix: Monitoreo en GNS3</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* 1. CONFIGURACIÓN GENERAL */
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #e2e8f0; /* Un fondo neutro para la página */
            display: grid;
            gap: 20px;
            grid-template-columns: 1fr;
            margin: 0;
            min-height: 100vh;
            padding: 20px 0;
            place-items: center;
        }

        .slide-container {
            align-items: center;
            /* Tema Oscuro: Fondo principal de la diapositiva */
            background-color: #121212;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            height: 720px;
            justify-content: center;
            overflow: hidden;
            padding: 60px;
            position: relative;
            width: 1280px;
        }

        /* 1.1 Estilo de fondo abstracto (opcional, para diapositivas que no son de imagen) */
        .slide-container::before {
            content: '';
            position: absolute;
            top: -150px;
            left: -200px;
            width: 400px;
            height: 400px;
            /* Color de acento 1 */
            background: radial-gradient(circle, rgba(74, 144, 226, 0.15), transparent 70%);
            z-index: 0;
            filter: blur(50px);
        }
        .slide-container::after {
            content: '';
            position: absolute;
            bottom: -150px;
            right: -200px;
            width: 400px;
            height: 400px;
            /* Color de acento 2 */
            background: radial-gradient(circle, rgba(123, 200, 246, 0.1), transparent 70%);
            z-index: 0;
            filter: blur(50px);
        }

        .slide-container > * {
            position: relative;
            z-index: 1; /* Asegura que el contenido esté sobre los fondos */
        }

        /* 2. TIPOGRAFÍA COHERENTE (Poppins y Lato) */

        /* Fuentes de Encabezado */
        .slide-container h1,
        .slide-container h2,
        .slide-container h3,
        .slide-container blockquote {
            /* Color de texto principal */
            color: #FFFFFF;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            margin: 0;
        }

        /* Fuentes de Cuerpo de Texto */
        .slide-container p,
        .slide-container li,
        .slide-container .subtitle,
        .slide-container cite,
        .slide-container .tile p {
            /* Color de texto secundario */
            color: #F0F0F0;
            font-family: 'Lato', sans-serif;
        }

        /* Tamaños de Fuente Coherentes */
        .slide-container h1 {
            font-size: 80px;
        }

        .slide-container .slide-title { /* h2 */
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: left;
            width: 100%;
            /* Color de acento 1 para títulos */
            color: #4A90E2; 
        }

        .slide-container .slide-title { /* h2 */
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 40px;
            text-align: left;
            width: 100%;
            /* Color de acento 1 para títulos - MEJORADO CON GRADIENTE */
            background: linear-gradient(135deg, #5aa0f2, #9ad4f8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #4A90E2; /* Fallback */
        }

        .slide-container h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            /* Color de acento 1 */
            color: #4A90E2;
        }

        /* Tamaño unificado de cuerpo de texto */
        .slide-container p,
        .slide-container li,
        .slide-container .subtitle,
        .slide-container cite,
        .slide-container .tile p {
            font-size: 22px;
            line-height: 1.6;
        }

        .slide-container .subtitle {
            font-size: 28px;
            font-weight: 400;
            margin-top: 20px;
            color: #F0F0F0;
        }

        .slide-container .content-area {
            align-items: center;
            display: flex;
            flex-grow: 1;
            justify-content: center;
            width: 100%;
        }

        /* 3. DEFINICIONES DE DISEÑO */

        /* Layout: Full_Background_Image (Usado para Título y Cierre) */
        .full-bg-image {
            padding: 0;
            background-position: center;
            background-size: cover;
        }
        
        .full-bg-image .content-overlay {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 60px;
            /* Superposición oscura para legibilidad */
            background-color: rgba(18, 18, 18, 0.7);
        }

        .full-bg-image h1,
        .full-bg-image .subtitle {
            color: #FFFFFF;
            /* Nos aseguramos que no tengan gradiente */
            background: none;
            -webkit-text-fill-color: unset;
        }

        /* Layout: Image_Right_Text_Left */
        .two-column {
            align-items: center; /* Centrado vertical */
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            width: 100%;
        }

        .two-column ul {
            list-style: none; /* Quitamos bullets estándar */
            margin: 0;
            padding: 0;
        }

        .two-column li {
            margin-bottom: 20px;
            padding-left: 35px;
            position: relative;
        }
        /* Bullet personalizado con color de acento */
        .two-column li::before {
            content: '✓';
            position: absolute;
            left: 0;
            top: 0;
            font-weight: 700;
            /* Color de acento 2 */
            color: #7BC8F6;
        }

        .image-wrapper {
            border-radius: 12px;
            height: 450px;
            overflow: hidden;
            width: 100%;
            background-color: #2a2a2a; /* Fondo para imágenes */
        }

        .image-wrapper img {
            height: 100%;
            /* 'contain' es mejor para logos y screenshots */
            object-fit: contain; 
            width: 100%;
        }

        /* Layout: Tiled_Text_With_Icons */
        .tiled-content {
            align-items: stretch;
            display: flex;
            gap: 40px;
            justify-content: center;
            width: 100%;
        }

        .tile {
            align-items: center;
            /* Color de fondo de las tarjetas */
            background-color: #1E1E1E; 
            border-radius: 12px;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            flex: 1;
            justify-content: flex-start;
            padding: 40px;
            text-align: center;
            /* Transición añadida para "vida" */
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }

        .tile:hover {
            /* Efecto "hover" añadido */
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(74, 144, 226, 0.2);
            border-color: #4A90E2;
        }

        .tile .icon {
            /* Color de acento 1 */
            color: #4A90E2;
            font-size: 48px;
            margin-bottom: 30px;
        }
        .tile h3 {
            font-size: 24px;
        }
        .tile p {
            font-size: 18px;
        }

        /* Layout: Styled_Bullet_Points */
        .bullet-list {
            max-width: 900px;
            width: 100%;
        }

        .bullet-list ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .bullet-list li {
            align-items: center; /* Alinea ícono y texto */
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            padding-left: 0;
            position: relative;
            /* Transición añadida */
            transition: transform 0.3s ease;
        }

        .bullet-list li:hover {
            /* Efecto "hover" añadido */
            transform: translateX(10px);
        }

        .bullet-list i {
            /* Color de acento 2 */
            color: #7BC8F6;
            font-size: 28px;
            text-align: center;
            width: 35px; /* Ancho fijo para alineación */
        }
        
        .bullet-list li p {
            margin: 0;
            flex: 1;
        }
        .bullet-list li code {
            background-color: #333;
            color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        /* Layout: Quote */
        .quote-layout {
            text-align: center;
            width: 90%;
        }

        .quote-layout blockquote {
            font-size: 48px;
            font-weight: 700;
            font-family: 'Courier New', Courier, monospace; /* Fuente monoespaciada para código */
            line-height: 1.4;
            margin: 0 0 30px 0;
            padding: 20px;
            position: relative;
            color: #FFFFFF;
            background-color: #1E1E1E;
            border: 1px solid #333;
            border-radius: 8px;
            border-left: 10px solid #4A90E2; /* Acento */
        }

        /* Ocultamos las comillas estándar para el código */
        .quote-layout blockquote::before,
        .quote-layout blockquote::after {
            content: none;
        }

        .quote-layout cite {
            color: #F0F0F0;
            font-size: 22px;
            font-style: normal;
        }
        
        .quote-layout .quote-intro {
            font-size: 22px;
            color: #F0F0F0;
            margin-bottom: 20px;
        }

        /* Layout: Q&A */
        .qa-layout {
            text-align: center;
            width: 100%;
            align-self: center;
        }

        .qa-layout h2 {
            font-size: 80px;
            margin-bottom: 20px;
            /* Color de acento 1 - MEJORADO CON GRADIENTE */
            background: linear-gradient(135deg, #5aa0f2, #9ad4f8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #4A90E2; /* Fallback */
        }

        .qa-layout p {
            font-size: 28px;
            color: #F0F0F0;
        }

        .qa-layout .contact-info {
            color: #7BC8F6;
            font-size: 32px;
            font-weight: 700;
            margin-top: 40px;
        }

        /* --- NUEVAS ANIMACIONES --- */
        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Aplicar animación de entrada */
        .slide-container .slide-title,
        .slide-container h1 {
            animation: fadeInSlide 0.7s ease-out 0.3s both;
        }
        
        .slide-container .subtitle,
        .slide-container .content-area {
            animation: fadeInSlide 0.7s ease-out 0.5s both;
        }

        /* Stagger (escalonado) para listas y tarjetas */
        .bullet-list li,
        .two-column li,
        .tile {
            animation: fadeInSlide 0.6s ease-out both;
            /* Empezamos con opacidad 0 antes de la animación */
            opacity: 0;
        }

        .bullet-list li:nth-child(1) { animation-delay: 0.5s; }
        .bullet-list li:nth-child(2) { animation-delay: 0.6s; }
        .bullet-list li:nth-child(3) { animation-delay: 0.7s; }
        .bullet-list li:nth-child(4) { animation-delay: 0.8s; }
        .bullet-list li:nth-child(5) { animation-delay: 0.9s; }
        .bullet-list li:nth-child(6) { animation-delay: 1.0s; }

        .two-column li:nth-child(1) { animation-delay: 0.5s; }
        .two-column li:nth-child(2) { animation-delay: 0.6s; }
        .two-column li:nth-child(3) { animation-delay: 0.7s; }

        .tile:nth-child(1) { animation-delay: 0.5s; }
        .tile:nth-child(2) { animation-delay: 0.7s; }
        .tile:nth-child(3) { animation-delay: 0.9s; }

        .quote-layout .quote-intro { animation: fadeInSlide 0.7s ease-out 0.5s both; }
        .quote-layout blockquote { animation: fadeInSlide 0.7s ease-out 0.7s both; }
        .quote-layout cite { animation: fadeInSlide 0.7s ease-out 0.9s both; }

        .qa-layout h2 { animation-delay: 0.3s; }
        .qa-layout p:nth-of-type(1) { animation-delay: 0.5s; }
        .qa-layout p:nth-of-type(2) { animation-delay: 0.6s; }
        .qa-layout .contact-info { animation-delay: 0.8s; }
        
        .two-column .image-wrapper {
             animation: fadeInSlide 0.7s ease-out 0.6s both;
        }

        /* --- NUEVO CSS PARA GEMINI --- */

        .gemini-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            width: 100%;
            align-items: flex-start;
        }

        #gemini-prompt-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        #gemini-prompt {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border-radius: 8px;
            border: 1px solid #555;
            background-color: #2a2a2a;
            color: #F0F0F0;
            font-family: 'Lato', sans-serif;
            resize: vertical;
        }

        #gemini-ask-btn {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            color: #FFFFFF;
            background: linear-gradient(135deg, #4A90E2, #7BC8F6);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        #gemini-ask-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(74, 144, 226, 0.2);
        }

        #gemini-ask-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #gemini-response-container {
            background-color: #1E1E1E;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 30px;
            min-height: 300px;
            max-height: 400px;
            color: #F0F0F0;
            font-family: 'Lato', sans-serif;
            line-height: 1.6;
            overflow-y: auto;
            font-size: 16px;
        }

        #gemini-response-container p:first-child {
            margin-top: 0;
        }
        #gemini-response-container p:last-child {
            margin-bottom: 0;
        }

        /* Loading Spinner */
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #F0F0F0;
            border-bottom-color: #4A90E2;
            border-radius: 50%;
            display: block;
            margin: 20px auto;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

<!-- Slide 1: Full_Background_Image (Title) -->
<div class="slide-container full-bg-image" id="slide1" style="background-image: url('http://googleusercontent.com/image_collection/image_retrieval/14481768430061027841');">
    <div class="content-overlay">
        <h1>Zabbix: Tu Red Bajo Control</h1>
        <p class="subtitle">De la Instalación en Ubuntu al Monitoreo en GNS3</p>
    </div>
</div>

<!-- Slide 2: Image_Right_Text_Left (What is Zabbix?) -->
<div class="slide-container" id="slide2">
    <h2 class="slide-title">¿Qué es Zabbix?</h2>
    <div class="content-area">
        <div class="two-column">
            <div>
                <ul>
                    <li>Solución de monitoreo open-source de nivel empresarial.</li>
                    <li>Recopila métricas de red, servidores, apps y la nube.</li>
                    <li>Visualiza datos, detecta problemas y envía alertas.</li>
                    <li>Perfecto para infraestructuras de cualquier tamaño.</li>
                </ul>
            </div>
            <div>
                <div class="image-wrapper">
                    <img src="http://googleusercontent.com/image_collection/image_retrieval/3697057872845383611" alt="Logo de Zabbix sobre fondo oscuro">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slide 3: Tiled_Text_With_Icons (The Lab) -->
<div class="slide-container" id="slide3">
    <h2 class="slide-title">Nuestro Laboratorio</h2>
    <div class="content-area">
        <div class="tiled-content">
            <div class="tile">
                <div class="icon"><i class="fa-solid fa-server"></i></div>
                <h3>Zabbix Server</h3>
                <p>Una máquina virtual corriendo Ubuntu 22.04 LTS donde instalaremos Zabbix.</p>
            </div>
            <div class="tile">
                <div class="icon"><i class="fa-solid fa-network-wired"></i></div>
                <h3>Router Cisco</h3>
                <p>Un dispositivo virtual (vIOS) dentro de GNS3 que será nuestro objetivo de monitoreo.</p>
            </div>
            <div class="tile">
                <div class="icon"><i class="fa-solid fa-cloud"></i></div>
                <h3>Conexión</h3>
                <p>Un nodo 'Cloud' en GNS3 que une la red virtual con la VM de Zabbix (vía NAT o Bridge).</p>
            </div>
        </div>
    </div>
</div>

<!-- Slide 4: Styled_Bullet_Points (Install) -->
<div class="slide-container" id="slide4">
    <h2 class="slide-title">Paso 1: Instalación en Ubuntu 22.04</h2>
    <div class="content-area">
        <div class="bullet-list">
            <ul>
                <li><i class="fa-solid fa-download"></i><p>Añadir el Repositorio oficial de Zabbix (6.0 LTS).</p></li>
                <li><i class="fa-solid fa-cogs"></i><p>Instalar paquetes: <code>zabbix-server-mysql</code>, <code>zabbix-frontend-php</code>, <code>zabbix-agent</code>.</p></li>
                <li><i class="fa-solid fa-database"></i><p>Crear la base de datos y el usuario para Zabbix en MySQL.</p></li>
                <li><i class="fa-solid fa-file-import"></i><p>Importar el esquema inicial de la base de datos.</p></li>
                <li><i class="fa-solid fa-key"></i><p>Editar <code>/etc/zabbix/zabbix_server.conf</code> con la contraseña de la BD.</p></li>
                <li><i class="fa-solid fa-play-circle"></i><p>Reiniciar servicios y completar la configuración en el frontend web.</p></li>
            </ul>
        </div>
    </div>
</div>

<!-- Slide 5: Image_Right_Text_Left (GNS3 Setup) -->
<div class="slide-container" id="slide5">
    <h2 class="slide-title">Paso 2: Configurando GNS3</h2>
    <div class="content-area">
        <div class="two-column">
            <div>
                <ul>
                    <li>Arrastra un router Cisco (vIOS) a tu topología en GNS3.</li>
                    <li>Añade un nodo 'Cloud' (NAT o Bridge) para conectar tu VM Zabbix.</li>
                    <li>Asegura que haya conectividad IP (¡usa <code>ping</code>!) entre el router y el servidor Zabbix.</li>
                </ul>
            </div>
            <div>
                <div class="image-wrapper">
                    <img src="http://googleusercontent.com/image_collection/image_retrieval/14041612827160683475" alt="Diagrama de topología de red en GNS3 mostrando un router y una nube">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slide 6: Quote (SNMP) -->
<div class="slide-container" id="slide6">
    <h2 class="slide-title">Paso 3: Habilitando SNMP</h2>
    <div class="content-area">
        <div class="quote-layout">
            <p class="quote-intro">SNMP (Protocolo Simple de Administración de Red) permite a Zabbix "preguntar" al router por su estado. Lo activamos en el router Cisco con:</p>
            <blockquote>snmp-server community zabbix-ro RO</blockquote>
            <cite>Esta es la configuración clave en el router para permitir la lectura (Read-Only).</cite>
        </div>
    </div>
</div>

<!-- Slide 7: Image_Right_Text_Left (Zabbix at Work) -->
<div class="slide-container" id="slide7">
    <h2 class="slide-title">Paso 4: ¡Magia! Zabbix en Acción</h2>
    <div class="content-area">
        <div class="two-column">
            <div>
                <ul>
                    <li>Ir a <strong>Configuration &rarr; Hosts &rarr; Create host</strong>.</li>
                    <li>Añadir la IP del router y seleccionar un Grupo.</li>
                    <li>En la pestaña <strong>Interfaces</strong>, añadir una de tipo <code>SNMP</code>.</li>
                    <li>En <strong>Templates</strong>, enlazar la plantilla 'Cisco IOS by SNMP'.</li>
                    <li>En <strong>Macros</strong>, ajustar <code>{$SNMP_COMMUNITY}</code> a 'zabbix-ro'.</li>
                </ul>
            </div>
            <div>
                <div class="image-wrapper">
                    <img src="http://googleusercontent.com/image_collection/image_retrieval/14349374037522455842" alt="Dashboard de Zabbix mostrando métricas de interfaz de red">
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Slide 8: Full_Background_Image (Result) -->
<div class="slide-container full-bg-image" id="slide8" style="background-image: url('http://googleusercontent.com/image_collection/image_retrieval/16341997362409157595');">
    <div class="content-overlay">
        <h1>El Resultado: Visibilidad Total</h1>
        <p class="subtitle">Datos de CPU, memoria y tráfico de red fluyendo en tiempo real desde GNS3.</p>
    </div>
</div>

<!-- Slide 9: Q&A (Conclusion) -->
<div class="slide-container" id="slide9">
    <div class="qa-layout">
        <h2>¿Próximo Paso?</h2>
        <p>¡No te limites a observar, automatiza! Zabbix es una herramienta increíblemente poderosa.</p>
        <p>¡Explórala y experimenta!</p>
        <div class="contact-info">
            ¡Gracias por tu atención!
        </div>
    </div>
</div>

<!-- Slide 10: Gemini AI Troubleshooter -->
<div class="slide-container" id="slide10">
    <h2 class="slide-title">Solucionador de Problemas ✨</h2>
    <div class="content-area">
        <div class="gemini-layout">
            <div id="gemini-prompt-container">
                <p>¿Atascado? Pregúntale a nuestro asistente experto en Zabbix y GNS3.</p>
                <textarea id="gemini-prompt" rows="4" placeholder="Ej: 'Mi host SNMP no responde en Zabbix, ¿qué reviso?'"></textarea>
                <button id="gemini-ask-btn">
                    <i class="fa-solid fa-magic-sparkles"></i> Preguntar al Experto
                </button>
            </div>
            
            <div id="gemini-response-container">
                <p id="gemini-response-placeholder">Tu respuesta aparecerá aquí...</p>
                <div id="gemini-response" style="display: none;"></div>
            </div>
        </div>
    </div>
</div>

</body>

<script>
    const askButton = document.getElementById('gemini-ask-btn');
    const promptInput = document.getElementById('gemini-prompt');
    const responseContainer = document.getElementById('gemini-response');
    const responsePlaceholder = document.getElementById('gemini-response-placeholder');

    if (askButton) {
        askButton.addEventListener('click', handleGeminiQuery);
    }

    async function handleGeminiQuery() {
        const userQuery = promptInput.value;
        if (!userQuery.trim()) {
            responseContainer.innerHTML = '<p style="color: #ff6b6b;">Por favor, escribe una pregunta.</p>';
            responseContainer.style.display = 'block';
            responsePlaceholder.style.display = 'none';
            return;
        }

        setLoading(true);

        const systemPrompt = "Eres un experto de clase mundial en Zabbix, GNS3, redes Cisco y SNMP. Tu objetivo es ayudar a un usuario a solucionar un problema. Proporciona respuestas claras, concisas y en formato markdown (usa '*' para bullets). Ve al grano y ofrece pasos accionables. La pregunta del usuario es:";
        const fullPrompt = ${systemPrompt}\n\n${userQuery};

        try {
            const generatedText = await callGeminiApi(fullPrompt);
            displayResponse(generatedText);
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            displayResponse("Lo siento, ocurrió un error al contactar al asistente. Por favor, revisa la consola para más detalles.", true);
        } finally {
            setLoading(false);
        }
    }

    async function callGeminiApi(prompt, retries = 3, delay = 1000) {
        const apiKey = ""; // API key will be provided by the environment
        const apiUrl = https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey};

        const payload = {
            contents: [{
                parts: [{ text: prompt }]
            }],
            // No system instruction for this model, include it in the main prompt.
        };

        for (let i = 0; i < retries; i++) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(HTTP error! status: ${response.status}, body: ${errorBody});
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                    return data.candidates[0].content.parts[0].text;
                } else {
                    console.warn("Unexpected API response structure:", data);
                    throw new Error("Respuesta inesperada de la API de Gemini.");
                }

            } catch (error) {
                console.warn(API call attempt ${i + 1} failed. Retrying in ${delay}ms..., error.message);
                if (i === retries - 1) {
                    throw error; // Throw error after last retry
                }
                await new Promise(resolve => setTimeout(resolve, delay));
                delay *= 2; // Exponential backoff
            }
        }
    }

    function setLoading(isLoading) {
        if(askButton) askButton.disabled = isLoading;
        if (isLoading) {
            responsePlaceholder.style.display = 'none';
            responseContainer.style.display = 'block';
            responseContainer.innerHTML = '<div class="loader"></div>';
        } else {
            // Don't clear loader, displayResponse will do it
        }
    }

    function displayResponse(text, isError = false) {
        responseContainer.innerHTML = ''; // Clear loader
        responseContainer.style.display = 'block';
        responsePlaceholder.style.display = 'none';

        if (isError) {
            responseContainer.innerHTML = <p style="color: #ff6b6b;">${text}</p>;
        } else {
            // Basic markdown-to-HTML
            let formattedText = text
                .replace(/\n\n/g, '</p><p>') // Paragraphs
                .replace(/\n/g, '<br>') // Line breaks
                .replace(/\\(.?)\\*/g, '<strong>$1</strong>') // Bold
                .replace(/\(?!\)(.?)\/g, '<em>$1</em>') // Italic
                .replace(/([^]+)`/g, '<code>$1</code>') // Inline code
                .replace(/^\s*\\s(.?)$/gm, '<ul><li>$1</li></ul>') // Bullets (basic)
                .replace(/<\/ul>\s*<ul>/g, ''); // Merge adjacent lists

            responseContainer.innerHTML = formattedText;
        }
    }
</script>

</html>